---
phase: 02-calendar-export
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/services/export_reminders.go
  - internal/services/export_reminders_test.go
autonomous: true
requirements:
  - AREM-01
user_setup: []

must_haves:
  truths:
    - "User can trigger Apple Reminders export from study tasks"
    - "Exporter creates reminders through osascript using argv-safe parameter passing"
    - "Exporter returns clear timeout/permission errors instead of hanging"
  artifacts:
    - path: "internal/services/export_reminders.go"
      provides: "Apple Reminders exporter adapter with timeout and structured errors"
      exports: ["ExportAppleReminders"]
    - path: "internal/services/export_reminders_test.go"
      provides: "Automated coverage for command argument shape and error mapping"
  key_links:
    - from: "internal/services/export_reminders.go"
      to: "osascript"
      via: "exec.CommandContext"
      pattern: "exec\\.CommandContext\\(.*osascript"
    - from: "internal/services/export_reminders.go"
      to: "import_reminders_osascript_no_tags_v2.sh"
      via: "shared AppleScript argument conventions"
      pattern: "on run argv|make new reminder"
---

<objective>
Implement Apple Reminders export as a dedicated process adapter that batches study tasks into `osascript` reminder creation calls.

Purpose: Satisfy `AREM-01` using the existing local script patterns while integrating safely into Go services and keeping TUI responsive.
Output: `ExportAppleReminders` service + tests for args, timeout behavior, and actionable error handling.
</objective>

<execution_context>
@/Users/tommy/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/tommy/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-calendar-export/02-RESEARCH.md
@import_reminders.sh
@import_reminders_osascript_no_tags.sh
@import_reminders_osascript_no_tags_v2.sh
</context>

<tasks>

<task type="auto">
  <name>Create Apple Reminders exporter with timeout-safe osascript execution</name>
  <files>internal/services/export_reminders.go</files>
  <action>
    Implement `ExportAppleReminders` that accepts task input plus list/config options and invokes `osascript` via `exec.CommandContext`.
    Reuse the proven argument-passing approach from existing `import_reminders*_osascript*.sh` scripts (run handler + argv), instead of constructing shell command strings.
    Batch task exports, ensure list existence in AppleScript, and map failures to structured errors (timeout, permissions, script failure, empty input).
    Add configurable timeout defaults and return export counts + diagnostics for UI status messaging.
  </action>
  <verify>
    <automated>go test ./... && go build ./...</automated>
    <manual>On macOS, run a small export and confirm reminders appear in the target list; first-run automation permission prompt is handled with clear guidance.</manual>
  </verify>
  <done>Reminders exporter runs via osascript with argv-safe inputs, bounded execution time, and deterministic success/error reporting.</done>
</task>

<task type="auto">
  <name>Add reminder exporter tests without requiring live Reminders access</name>
  <files>internal/services/export_reminders_test.go</files>
  <action>
    Add tests using an injectable command runner so argument construction and error translation can be validated without launching actual `osascript` in CI.
    Cover success path, timeout path, and script error output path. Assert that user task text is passed as discrete args and not shell-concatenated.
    Keep tests fast and deterministic.
  </action>
  <verify>
    <automated>go test ./internal/services -run TestReminders -v</automated>
  </verify>
  <done>Automated tests protect against command construction regressions and hanging/error handling failures.</done>
</task>

</tasks>

<verification>
- `go test ./internal/services -run TestReminders -v` passes
- `go test ./...` and `go build ./...` pass
- Export path surfaces actionable errors for timeout/permission failures
</verification>

<success_criteria>
- [ ] `AREM-01`: Study tasks can be exported to Apple Reminders via osascript
- [ ] Exporter avoids command injection-prone string interpolation and uses argv arguments
- [ ] Exporter fails fast with clear timeout/permission guidance when macOS automation blocks
</success_criteria>

<output>
After completion, create `.planning/phases/02-calendar-export/02-02-SUMMARY.md`
</output>
