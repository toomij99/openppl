# Phase 04.1 Research: `openppl web` command

**Researched:** 2026-02-26
**Confidence:** HIGH

## Scope

Phase 04.1 adds a CLI web-mode command that starts the Go web server, validates host/port flags, and opens the browser to the correct URL.

## Key Findings

1. `main.go` already contains command routing patterns (`onboard`, `logs`, `help`) and web flag parsing behavior suitable for extension and hardening.
2. `internal/web/server.go` already exposes a clean entrypoint (`Run(db, host, port)`), so phase work should keep command parsing in `main.go` and server/runtime concerns in `internal/web`.
3. `internal/web/browser.go` has host translation (`0.0.0.0`/`::` -> `localhost`) and cross-platform browser invocation (`open`/`xdg-open`/`rundll32`) that should be preserved and expanded with edge-case tests.
4. No dedicated tests exist for web CLI flag parsing and error behavior; this is a key gap for deterministic automation and safe rollout.

## Recommended Architecture

- Keep boundary separation:
  - `main.go`: command dispatch + input validation + onboarding pre-check
  - `internal/web/server.go`: HTTP routes and runtime startup
  - `internal/web/browser.go`: URL normalization and OS launch behavior
- Add command-focused tests in `main_web_test.go` and browser URL behavior tests in `internal/web/browser_test.go`.
- Preserve non-interactive error semantics: invalid flags should return explicit errors and non-zero exit codes.

## Requirements Proposed for This Phase

- `WEB-01`: `openppl web` launches the web server and attempts browser open to the expected URL.
- `WEB-02`: `--hostname` and `--port` are validated with clear errors on invalid values.
- `WEB-03`: web mode follows onboarding/setup checks and does not regress existing CLI commands.

## Pitfalls

- Putting browser launch policy into `main.go` instead of `internal/web/browser.go` increases coupling.
- Accepting invalid host/port silently can produce hard-to-debug startup failures.
- Reusing TUI-only code paths in web mode can introduce interactive side effects in non-TUI flows.
